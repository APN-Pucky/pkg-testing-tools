name: test self

on:
  push:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest
    container: apnpucky/gentoo-apn:latest
    strategy:
      fail-fast: false
      matrix:
        args: [
          '-C -p "=pkg-testing-tools-9999" --pretend',
          '-C -p "=pkg-testing-tools-9999"',
          '-f /var/db/repos/gentoo/app-portage/pkg-testing-tools/pkg-testing-tools-9999.ebuild',
          '-p =pkg-testing-tools-9999',
          "--test-feature-scope never --append-required-use '!pgo' --max-use-combinations 6 -p www-client/firefox --pretend",
        ]
    steps:
    - run: emerge --sync
    - run: echo 'app-portage/pkg-testing-tools **' > /etc/portage/package.accept_keywords/pkg-testing-tools
    - run: emerge =pkg-testing-tools-9999
    - run: pkg-testing-tool ${{ matrix.args }}
